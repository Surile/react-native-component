{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "picker-view",
  "type": "registry:component",
  "title": "Example picker-view",
  "author": "@gabimoncha",
  "description": "Displays a button which is always red.",
  "registryDependencies": [
    "https://react-native-component-docs.vercel.app/r/hooks.json",
    "https://react-native-component-docs.vercel.app/r/helpers.json",
    "https://react-native-component-docs.vercel.app/r/loading.json",
    "https://react-native-component-docs.vercel.app/r/divider.json"
  ],
  "files": [
    {
      "path": "./node_modules/@tastien/react-native-component/src/components/picker-view/picker-view.tsx",
      "content": "import React, { memo, useEffect, useMemo, useRef, useState } from 'react';\nimport { isEmpty } from 'lodash';\nimport isNil from 'lodash/isNil';\nimport { StyleProp, View, ViewStyle } from 'react-native';\nimport {\n  buildOptions,\n  buildSelectedValue,\n  findDefaultValue,\n  findNextAllColumns,\n  getDataType,\n} from './helper/picker';\nimport type { PickerOption, PickerValue, PickerViewProps } from './interface';\nimport PickerColumn from './picker-view-column';\nimport { useControllableValue } from '../../hooks';\nimport Loading from '../loading';\nimport Divider from '../divider';\n\nconst getVisibleItemCount = (n: number) => {\n  if (n % 2 === 0) {\n    return n + 1;\n  }\n\n  return n;\n};\n\n/**\n * é€‰æ‹©å™¨è§†å›¾\n */\nconst PickerView: React.FC<PickerViewProps> = ({\n  visibleItemCount = 5,\n  loading = false,\n  columns,\n  itemHeight = 50,\n  testID,\n  ...restProps\n}) => {\n  const _visibleItemCount = getVisibleItemCount(visibleItemCount);\n  /** é€‰é¡¹çš„é«˜åº¦ */\n  const columnsHeight = _visibleItemCount * itemHeight;\n  /** å±…ä¸­é€‰ä¸­çš„åç§»é‡ */\n  const markMargin = itemHeight / 2;\n\n  /**\n   * æ•°æ®ç±»å‹\n   * @description cascade è”çº§é€‰æ‹©ï¼Œmultiple å¤šåˆ—é€‰æ‹©ï¼Œsingle å•åˆ—é€‰æ‹©\n   */\n  const dataType = useMemo(() => getDataType(columns), [columns]);\n  const isControlled = 'value' in restProps;\n  const isNoDefaultValue =\n    isNil(restProps.defaultValue) ||\n    isEmpty(restProps.defaultValue) ||\n    restProps.defaultValue.every((val) => val === '');\n\n  const [value, onChange] = useControllableValue<PickerValue[]>(restProps, {\n    defaultValue: [],\n  });\n  const [options, setOptions] = useState<PickerOption[][]>([]);\n  const ColumnDefaultValues = useRef<PickerValue[]>([]);\n\n  // åˆå§‹åŒ–æ•°æ®\n  useEffect(() => {\n    if (dataType !== 'cascade') {\n      const [_options, defaultValues] = buildOptions(dataType, columns);\n\n      ColumnDefaultValues.current = defaultValues;\n      setOptions(_options);\n\n      // éå—æ§çš„æƒ…å†µã€å¹¶ä¸”æ²¡æœ‰é»˜è®¤å€¼æ‰å»åŒæ­¥æ•°æ®\n      // æ—¢ç„¶æœ‰é»˜è®¤æ•°æ®äº†ï¼Œç”±å¤–é¢è‡ªå·±è´Ÿè´£\n      // æŠŠæ•°æ®åŒæ­¥åˆ°å†…éƒ¨çŠ¶æ€ï¼Œåˆå§‹åŒ–çš„æ—¶å€™çœ‹èµ·æ¥æ˜¯é€‰ä¸­é»˜è®¤æ•°æ®æˆ–ç¬¬ä¸€ä¸ªæ•°æ®çš„æ ·å­\n\n      if (!isControlled && isNoDefaultValue) {\n        const [v, o] = buildSelectedValue(defaultValues, _options);\n\n        onChange(v, o);\n      }\n    }\n  }, [columns, dataType, onChange, isControlled, isNoDefaultValue]);\n\n  // è”çº§ä¾èµ– value å•ç‹¬å¤„ç†\n  useEffect(() => {\n    if (dataType === 'cascade') {\n      const [_options, , _values] = buildOptions(dataType, columns, value);\n      const [v, o] = buildSelectedValue(_values, _options);\n\n      setOptions(_options);\n\n      // å½“\n      if (value !== _values) {\n        onChange(v, o);\n      }\n    }\n  }, [columns, value, dataType, onChange]);\n\n  const bodyStyle: ViewStyle = {\n    height: columnsHeight,\n    backgroundColor: 'white',\n    flexDirection: 'row',\n    overflow: 'hidden',\n  };\n\n  console.log('columnsHeight', columnsHeight);\n\n  const maskTopStyles: StyleProp<ViewStyle> = [\n    {\n      top: 0,\n      bottom: '50%',\n      flexDirection: 'column-reverse',\n      transform: [\n        {\n          translateY: -markMargin,\n        },\n      ],\n    },\n  ];\n\n  const maskBottomStyles: StyleProp<ViewStyle> = [\n    {\n      top: '50%',\n      bottom: 0,\n      transform: [\n        {\n          translateY: markMargin,\n        },\n      ],\n    },\n  ];\n\n  return (\n    <View testID={testID} className='overflow-hidden bg-white'>\n      {loading ? (\n        <View className='absolute inset-0 z-[2] size-full items-center justify-center bg-white opacity-80'>\n          <Loading />\n        </View>\n      ) : null}\n\n      <View style={bodyStyle}>\n        <View\n          className='absolute inset-x-0 z-[3] bg-white opacity-80'\n          style={maskTopStyles}\n          pointerEvents='none'\n        >\n          <Divider />\n        </View>\n\n        <View\n          className='absolute inset-x-0 z-[3] bg-white opacity-80'\n          style={maskBottomStyles}\n          pointerEvents='none'\n        >\n          <Divider />\n        </View>\n\n        {options.map((optionItem, optionIndex) => {\n          const _value = (() => {\n            if (!isNil(value[optionIndex])) {\n              return value[optionIndex];\n            }\n\n            // é»˜è®¤å€¼\n            // éå—æ§çš„æƒ…å†µæ‰å»åŒæ­¥æ•°æ®\n            // å¹¶ä¸”æ²¡æœ‰é»˜è®¤å€¼\n            if (!isControlled && isNoDefaultValue) {\n              if (dataType === 'multiple') {\n                return ColumnDefaultValues.current[optionIndex];\n              }\n\n              // çœŸçš„æ²¡æœ‰å°±é»˜è®¤ç¬¬ä¸€ä¸ªé€‰é¡¹\n              return findDefaultValue(options[optionIndex][0]?.value, optionItem)!;\n            }\n\n            return undefined;\n          })();\n\n          return (\n            <PickerColumn\n              itemHeight={itemHeight}\n              key={optionIndex}\n              visibleItemCount={_visibleItemCount}\n              options={optionItem}\n              value={_value}\n              onChange={(column) => {\n                switch (dataType) {\n                  // è”çº§é€‰æ‹©\n                  // å¦‚æœæ˜¯ cascade éœ€è¦é‡ç½®é€‰é¡¹\n                  case 'cascade': {\n                    const nextAll = findNextAllColumns(column?.children || []);\n                    const _options = options.slice(0, optionIndex + 1).concat(nextAll.options);\n                    const values = value\n                      .slice(0, optionIndex)\n                      .concat(column?.value)\n                      .concat(nextAll.values);\n\n                    const [v, o] = buildSelectedValue(values, _options);\n\n                    onChange(v, o);\n\n                    break;\n                  }\n\n                  // å¤šé€‰\n                  case 'multiple': {\n                    const newValues = value.concat([]);\n\n                    // å…ˆä»é»˜è®¤æ•°æ®ä¸­æ‹¼å‡‘å¥½æ•°æ®\n                    ColumnDefaultValues.current.forEach((cdv, cdvIndex) => {\n                      if (isNil(newValues[cdvIndex])) {\n                        newValues[cdvIndex] = cdv;\n                      }\n                    });\n\n                    newValues[optionIndex] = column.value;\n\n                    const [v, o] = buildSelectedValue(newValues, options);\n\n                    onChange(v, o);\n\n                    break;\n                  }\n\n                  // å•é€‰\n                  default: {\n                    const columnsIndex = columns.findIndex(\n                      (c) => (c as PickerOption).value === column.value\n                    );\n\n                    onChange([column?.value], [columns[columnsIndex]]);\n\n                    break;\n                  }\n                }\n              }}\n            />\n          );\n        })}\n      </View>\n    </View>\n  );\n};\n\nexport default memo(PickerView);\n",
      "type": "registry:component"
    },
    {
      "path": "./node_modules/@tastien/react-native-component/src/components/picker-view/helper/column.ts",
      "content": "import type { PickerOption } from '../interface';\n\n/**\n * æŒ‰ç…§æŸä¸ªæ–¹å‘æ‰¾åˆ°å¯ç”¨é€‰é¡¹çš„ä¸‹æ ‡\n */\nconst findAvailableOptionsIndex = (options: PickerOption[], start: number, end: number) => {\n  const isNext = end - start >= 0;\n\n  for (let iii = start; isNext ? iii <= end : iii >= end; iii += isNext ? 1 : -1) {\n    const item = options[iii];\n\n    if (!item.disabled) {\n      return iii;\n    }\n  }\n\n  return -1;\n};\n\nexport const findUsableOptionIndex = (\n  options: PickerOption[],\n  /** å‘ä¸‹æŸ¥æ‰¾è¿˜æ˜¯å‘ä¸Š */\n  next: boolean,\n  /** èµ·ç‚¹ä¸‹æ ‡ */\n  index: number,\n  /** æ˜¯å¦å¯ä»¥ç¿»è½¬æŸ¥æ‰¾ */\n  reverse = true,\n) => {\n  const maxIndex = options.length - 1;\n\n  // ä¸¤ç«¯çš„æƒ…å†µä¸èƒ½åè½¬æŸ¥æ‰¾\n  if (reverse && (index === 0 || index === maxIndex)) {\n    reverse = false;\n  }\n\n  // é¡¶ç«¯ä¸èƒ½ç»§ç»­å‘ä¸Šæ‰¾\n  if (index === 0 && !next) {\n    next = true;\n  }\n\n  // æœ«ç«¯ä¸èƒ½ç»§ç»­å‘ä¸‹æ‰¾\n  if (index === maxIndex && next) {\n    next = false;\n  }\n\n  const getEnd = (cNext: boolean) => {\n    return cNext ? maxIndex : 0;\n  };\n\n  // ä»¥å½“å‰ä¸ºèµ·ç‚¹å‘æŸä¸ªæ–¹å‘æ‰¾\n  let nIndex = findAvailableOptionsIndex(options, index, getEnd(next));\n\n  if (nIndex === -1 && reverse) {\n    nIndex = findAvailableOptionsIndex(options, index, getEnd(!next));\n  }\n\n  return nIndex;\n};\n",
      "type": "registry:component"
    },
    {
      "path": "./node_modules/@tastien/react-native-component/src/components/picker-view/helper/picker.ts",
      "content": "import isArray from 'lodash/isArray';\nimport type {\n  Column,\n  PickerOption,\n  PickerOptionCascade,\n  PickerOptionMultiple,\n  PickerOptionMultipleWidthDefaultValue,\n  PickerOptionType,\n  PickerValue,\n} from '../interface';\n\n/**\n * è·å–å½“å‰é€‰é¡¹æ˜¯ä»€ä¹ˆæ•°æ®\n * @description cascade è”çº§é€‰æ‹©ï¼Œmultiple å¤šåˆ—é€‰æ‹©ï¼Œsingle å•åˆ—é€‰æ‹©\n */\nexport const getDataType = (columns: Column[]): PickerOptionType => {\n  // eslint-disable-next-line prefer-destructuring\n  const firstColumn = columns[0];\n\n  if (firstColumn) {\n    if ('children' in firstColumn) {\n      return 'cascade';\n    }\n\n    if ('options' in firstColumn || isArray(firstColumn as PickerOption[])) {\n      return 'multiple';\n    }\n  }\n\n  return 'single';\n};\n\nexport const findDefaultValue = (value: PickerValue, options: PickerOption[]) => {\n  // value æ˜¯å¦åœ¨ options å†…\n  const valueIndex = options.findIndex((item) => item.value === value);\n\n  if (valueIndex < 0 || options[valueIndex].disabled) {\n    // é‡æ–°æ‰¾ä¸€ä¸ª\n    const index = options.findIndex((item) => !item.disabled);\n\n    if (index < 0) {\n      return null;\n    }\n\n    return options[index].value;\n  }\n\n  return value;\n};\n\n/** æŠŠè”çº§é€‰æ‹©çš„æ‰€æœ‰å­çº§æ‰¾åˆ° */\nexport const findNextAllColumns = (columns: PickerOptionCascade[]) => {\n  const options: PickerOption[][] = [];\n\n  console.log('ğŸš€ ~ findNextAllColumns ~ options:', options);\n\n  const values: PickerValue[] = [];\n\n  console.log('ğŸš€ ~ findNextAllColumns ~ values:', values);\n\n  const findNext = (c: PickerOptionCascade[]) => {\n    if (c.length) {\n      options.push(c);\n      values.push(c[0].value);\n\n      const cc = c[0].children || [];\n\n      findNext(cc);\n    }\n  };\n\n  findNext(columns);\n\n  return {\n    options,\n    values,\n  };\n};\n\n/** é€šè¿‡å·²æœ‰å€¼æ‰¾åˆ°è”çº§é€‰æ‹©çš„æ‰€æœ‰å­çº§æ‰¾åˆ° */\nexport const findAllColumnsByValues = (columns: PickerOptionCascade[], values: PickerValue[]) => {\n  const options: PickerOption[][] = [];\n\n  // TODO è¡¥å…¨å€™é€‰é¡¹è¿˜æ˜¯ä¸éœ€è¦ç®¡\n\n  let currentColumn = columns;\n\n  values.forEach((value) => {\n    options.push(currentColumn);\n\n    const nextIndex = currentColumn.findIndex((item) => item.value === value);\n\n    currentColumn = currentColumn[nextIndex]?.children || [];\n  });\n\n  return options;\n};\n\n/** æ„å»ºé€‰é¡¹ */\nexport const buildOptions = (\n  dataType: PickerOptionType,\n  columns: Column[],\n  values?: PickerValue[],\n): [PickerOption[][], PickerValue[], PickerValue[]] => {\n  switch (dataType) {\n    case 'cascade': {\n      if (!values?.length) {\n        const data = findNextAllColumns(columns as PickerOptionCascade[]);\n\n        return [data.options, [], data.values];\n      }\n\n      return [findAllColumnsByValues(columns as PickerOptionCascade[], values), [], values];\n    }\n\n    case 'multiple': {\n      const mixOptions: PickerOption[][] = [];\n      const defaultValues: PickerValue[] = [];\n\n      (columns as PickerOptionMultiple[]).forEach((item) => {\n        const isOption = isArray(item as PickerOption[]);\n\n        // é»˜è®¤å€¼éœ€è¦æ£€éªŒå®ƒæ˜¯å¦åˆæ³•\n        if (isOption) {\n          const option = item as PickerOption[];\n\n          mixOptions.push(option);\n          defaultValues.push(findDefaultValue(option[0].value, option)!);\n        } else {\n          const { options: _options, defaultValue: _defaultValue } = item as PickerOptionMultipleWidthDefaultValue;\n\n          mixOptions.push(_options);\n          defaultValues.push(findDefaultValue(_defaultValue!, _options)!);\n        }\n      });\n\n      return [mixOptions, defaultValues, []];\n    }\n\n    default: {\n      const options = [columns as PickerOption[]];\n\n      // eslint-disable-next-line prefer-destructuring\n      const [firstColumn] = options[0];\n      const defaultValues = [firstColumn?.value];\n\n      return [options, defaultValues, []];\n    }\n  }\n};\n\n/** æ„å»ºé€‰ä¸­çš„å€¼ */\nexport const buildSelectedValue = (values: PickerValue[], options: PickerOption[][]): [PickerValue[], Column[]] => {\n  const selectedColumns = values.map((v, index) => {\n    const vIndex = options[index].findIndex((o) => o.value === v);\n\n    return options[index][vIndex];\n  });\n\n  return [values, selectedColumns];\n};\n",
      "type": "registry:component"
    },
    {
      "path": "./node_modules/@tastien/react-native-component/src/components/picker-view/index.ts",
      "content": "import PickerView from './picker-view';\n\nexport default PickerView;\n",
      "type": "registry:component"
    },
    {
      "path": "./node_modules/@tastien/react-native-component/src/components/picker-view/interface.ts",
      "content": "import type { ViewProps } from 'react-native';\n\nexport type PickerOptionType = 'cascade' | 'multiple' | 'single';\n\nexport type PickerValue = string | number;\n\n/** å•åˆ—é€‰æ‹© */\nexport type PickerOption = {\n  value: PickerValue;\n  label: PickerValue;\n  disabled?: boolean;\n  // for custom filed names\n  [key: string]: any;\n};\n\nexport type PickerOptionMultipleWidthDefaultValue = {\n  defaultValue?: PickerValue;\n  options: PickerOption[];\n};\n\n/** å¤šåˆ—é€‰æ‹© */\nexport type PickerOptionMultiple = PickerOptionMultipleWidthDefaultValue | PickerOption[];\n\n/** è”çº§é€‰æ‹© */\nexport type PickerOptionCascade = PickerOption & {\n  children?: PickerOptionCascade[];\n  // for custom filed names\n  [key: string]: any;\n};\n\nexport type Column = PickerOption | PickerOptionMultiple | PickerOptionCascade;\n\nexport interface PickerViewProps extends Pick<ViewProps, 'testID'> {\n  value?: PickerValue[];\n\n  defaultValue?: PickerValue[];\n\n  /**\n   * å˜åŒ–æ—¶çš„å›è°ƒå‡½æ•°\n   */\n  onChange?: (values: PickerValue[], options: Column[]) => void;\n\n  /**\n   * é€‰é¡¹æ•°ç»„ï¼Œé…ç½®æ¯ä¸€åˆ—æ˜¾ç¤ºçš„æ•°æ®\n   */\n  columns: Column[];\n\n  /**\n   * æ˜¯å¦æ˜¾ç¤ºåŠ è½½çŠ¶æ€\n   * @default false\n   */\n  loading?: boolean;\n\n  /**\n   * é€‰é¡¹é«˜åº¦\n   * @default 50\n   */\n  itemHeight?: number;\n\n  /**\n   * å¯è§çš„é€‰é¡¹ä¸ªæ•°ï¼Œå¥‡æ•°\n   * @default 5\n   */\n  visibleItemCount?: number;\n}\n\nexport interface PickerViewColumnProps {\n  /**\n   * é€‰é¡¹é«˜åº¦\n   */\n  itemHeight: number;\n\n  /**\n   * é€‰é¡¹\n   */\n  options: PickerOption[];\n\n  /**\n   * å½“å‰å€¼\n   */\n  value?: PickerValue;\n\n  /**\n   * å¯è§çš„é€‰é¡¹ä¸ªæ•°\n   */\n  visibleItemCount: number;\n\n  /**\n   * å½“å€¼å˜åŒ–çš„æ—¶å€™\n   */\n  onChange?: (v: PickerOption) => void;\n}\n",
      "type": "registry:component"
    },
    {
      "path": "./node_modules/@tastien/react-native-component/src/components/picker-view/picker-view-column.tsx",
      "content": "import React, { memo, useEffect, useMemo, useRef } from 'react';\nimport type { FlatListProps } from 'react-native';\nimport { FlatList, Text, View } from 'react-native';\nimport { findUsableOptionIndex } from './helper/column';\nimport type { PickerViewColumnProps } from './interface';\nimport { usePersistFn } from '../../hooks';\nimport { ExcludeUndefined } from '../../helpers/types';\nimport { cn } from '../../lib/utils';\n\nconst getSelectedIndex = (n: number) => (n < 0 ? 0 : n);\n\n/**\n * é€‰æ‹©å™¨ åˆ—\n */\nconst PickerViewColumn: React.FC<PickerViewColumnProps> = ({\n  itemHeight,\n  visibleItemCount,\n  options,\n  value,\n  onChange,\n}) => {\n  const flatListRef = useRef<FlatList>(null);\n  const LastTop = useRef(0);\n  const paddedOptions = useMemo(() => {\n    const array = [...options];\n\n    for (let i = 0; i < (visibleItemCount - 1) / 2; i++) {\n      array.unshift({\n        value: '',\n        label: '',\n      });\n      array.push({\n        value: '',\n        label: '',\n      });\n    }\n\n    return array;\n  }, [options, visibleItemCount]);\n  const offsets = useMemo(\n    () => [...Array(paddedOptions.length)].map((x, i) => i * itemHeight),\n    [paddedOptions, itemHeight]\n  );\n\n  const selectedIndex = getSelectedIndex(options.findIndex((item) => item?.value === value));\n\n  useEffect(() => {\n    flatListRef.current?.scrollToIndex({\n      index: selectedIndex,\n      animated: false,\n    });\n  }, [selectedIndex]);\n\n  const onMomentumScrollEnd = usePersistFn<\n    ExcludeUndefined<FlatListProps<any>['onMomentumScrollEnd']>\n  >((event) => {\n    const offsetY = Math.min(\n      itemHeight * (options.length - 1),\n      Math.max(event.nativeEvent.contentOffset.y, 0)\n    );\n\n    let index = Math.floor(Math.floor(offsetY) / itemHeight);\n\n    const last = Math.floor(offsetY % itemHeight);\n\n    if (last > itemHeight / 2) {\n      index++;\n    }\n\n    const isToNext = offsetY > LastTop.current;\n\n    if (options[index]?.disabled) {\n      index = findUsableOptionIndex(options, isToNext, index);\n    }\n\n    LastTop.current = offsetY;\n\n    const selectOption = options[index];\n\n    if (selectOption?.value !== value) {\n      onChange?.(selectOption);\n    }\n  });\n\n  return (\n    <View className='flex-1'>\n      <FlatList\n        // å½“ options åˆ·æ–°æ—¶é‡ç½®ç»„ä»¶ï¼ŒscrollToIndex å¹¶ä¸èƒ½å®Œå…¨å¯é ï¼Œå€ŸåŠ© showsVerticalScrollIndicator åˆå§‹åŒ–è§†å›¾\n        key={paddedOptions.map((item) => item?.value).join('_')}\n        ref={flatListRef}\n        showsVerticalScrollIndicator={false}\n        snapToOffsets={offsets}\n        onMomentumScrollEnd={onMomentumScrollEnd}\n        initialScrollIndex={selectedIndex}\n        getItemLayout={(_, index) => ({\n          length: itemHeight,\n          offset: itemHeight * index,\n          index,\n        })}\n        decelerationRate='fast'\n        data={paddedOptions}\n        keyExtractor={(_, index) => index.toString()}\n        renderItem={({ item }) => {\n          return (\n            <Text\n              key={item?.value}\n              className={cn(\n                'text-sm text-center native:text-base text-muted-foreground',\n                item?.disabled ? 'text-muted-foreground' : 'text-foreground'\n              )}\n              style={{\n                height: itemHeight,\n                lineHeight: itemHeight,\n              }}\n              numberOfLines={2}\n            >\n              {item?.label}\n            </Text>\n          );\n        }}\n      />\n    </View>\n  );\n};\n\nexport default memo(PickerViewColumn);\n",
      "type": "registry:component"
    }
  ]
}